{"version":3,"file":"form-blocker.min.js","sources":["../../embed-script/src/index.ts"],"sourcesContent":["type SubmissionDecision = 'allowed' | 'challenged' | 'held' | 'blocked';\n\ninterface ChallengePayload {\n  type?: string;\n  question?: string;\n}\n\ninterface EvaluateSuccessResponse {\n  success: true;\n  decision: SubmissionDecision;\n  message: string;\n  submission_id?: string;\n  scores?: {\n    sales: number;\n    spam: number;\n  };\n  reasons?: string[];\n  challenge?: ChallengePayload;\n}\n\ninterface EvaluateErrorResponse {\n  success: false;\n  error: {\n    code?: string;\n    message?: string;\n  };\n}\n\ntype EvaluateResponsePayload = EvaluateSuccessResponse | EvaluateErrorResponse;\n\ninterface DetectionSnapshot {\n  urlDetected: boolean;\n  detectedUrls: string[];\n  schedulingUrls: string[];\n  salesKeywords: string[];\n  bannedKeywords: string[];\n  blockedDomains: string[];\n  pasteDetected: boolean;\n  contentLength: number;\n  updatedAt: number;\n}\n\nexport interface FormBlockerInitOptions {\n  apiKey: string;\n  apiBaseUrl?: string;\n  evaluatePath?: string;\n  selector?: string;\n  debug?: boolean;\n  previewMode?: boolean;\n  debugRules?: {\n    salesKeywords?: string[];\n    bannedKeywords?: string[];\n    blockedDomains?: string[];\n  };\n  observeMutations?: boolean;\n  discoveryIntervalMs?: number;\n  discoveryTimeoutMs?: number;\n  onAllow?: (result: EvaluateSuccessResponse) => void;\n  onBlock?: (result: EvaluateSuccessResponse) => void;\n  onChallenge?: (result: EvaluateSuccessResponse, allow: () => void) => void;\n  onHold?: (result: EvaluateSuccessResponse) => void;\n  onError?: (error: unknown) => void;\n  onDetectionUpdate?: (snapshot: DetectionSnapshot) => void;\n}\n\ninterface InternalConfig {\n  apiKey: string;\n  evaluateUrl: string;\n  selector: string;\n  debug: boolean;\n  previewMode: boolean;\n  salesKeywords: string[];\n  bannedKeywords: string[];\n  blockedDomains: string[];\n  observeMutations: boolean;\n  discoveryIntervalMs: number;\n  discoveryTimeoutMs: number | null;\n  onAllow?: FormBlockerInitOptions['onAllow'];\n  onBlock?: FormBlockerInitOptions['onBlock'];\n  onChallenge?: FormBlockerInitOptions['onChallenge'];\n  onHold?: FormBlockerInitOptions['onHold'];\n  onError?: FormBlockerInitOptions['onError'];\n  onDetectionUpdate?: FormBlockerInitOptions['onDetectionUpdate'];\n}\n\ninterface BehavioralSnapshot {\n  pasteDetected: boolean;\n  timeToSubmit: number | null;\n  pageLoadTime: number;\n}\n\ninterface FormContext {\n  originalSubmit: ((this: HTMLFormElement, ev: SubmitEvent) => unknown) | null;\n  submitHandler: EventListener;\n  pasteHandlers: Array<{ element: Element; handler: EventListener }>;\n  inputHandlers: Array<{ element: Element; handler: EventListener }>;\n  behavioral: BehavioralSnapshot;\n  lastDetection?: DetectionSnapshot;\n}\n\nconst FORM_BLOCKER_VERSION = '2024-12-05-fixed-base';\nconst DEFAULT_API_BASE = 'https://form-blocker.vercel.app';\n\nconst DEFAULT_SALES_KEYWORDS = ['営業', 'セールス', '提案', '御社', '貴社', '販売', '広告', '代理店'];\nconst DEFAULT_BANNED_KEYWORDS = ['無料', '限定', '販売促進', '広告代理店'];\nconst DEFAULT_SCHEDULING_DOMAINS = [\n  'calendly.com',\n  'youcanbook.me',\n  'scheduleonce.com',\n  'acuityscheduling.com',\n  'savvycal.com',\n  'hubspot.com',\n  'meetings.hubspot.com',\n  'tidycal.com',\n  'cal.com',\n];\n\nfunction normalizeDomain(domain: string): string {\n  return domain.trim().toLowerCase();\n}\n\nfunction matchesDomain(domain: string, target: string): boolean {\n  return domain === target || domain.endsWith(`.${target}`);\n}\n\nfunction extractHostname(url: string): string | null {\n  try {\n    return new URL(url).hostname.toLowerCase();\n  } catch {\n    const match = url.match(/https?:\\/\\/([^/\\s]+)/i);\n    return match?.[1]?.toLowerCase() ?? null;\n  }\n}\n\nfunction collectEmailDomains(formData: Record<string, unknown>): string[] {\n  const domains = new Set<string>();\n  const regex = /[\\w.+-]+@([A-Za-z0-9.-]+\\.[A-Za-z]{2,})/g;\n  Object.values(formData).forEach((value) => {\n    if (typeof value !== 'string') {\n      return;\n    }\n    const matches = value.matchAll(regex);\n    for (const match of matches) {\n      if (match[1]) {\n        domains.add(match[1].toLowerCase());\n      }\n    }\n  });\n  return Array.from(domains);\n}\n\nfunction getScriptOrigin(): string | null {\n  if (typeof document === 'undefined') {\n    return null;\n  }\n\n  const currentScript = document.currentScript as HTMLScriptElement | null;\n  const scripts = Array.from(document.querySelectorAll<HTMLScriptElement>('script'));\n  const scriptEl =\n    currentScript ||\n    scripts.find((script) => /form-blocker(\\.min)?\\.(js|mjs)$/.test(script.src) || script.dataset.apiBaseUrl);\n\n  const explicitBase = scriptEl?.dataset.apiBaseUrl?.trim();\n  const scriptSrc = scriptEl?.src;\n\n  try {\n    if (explicitBase) {\n      return new URL(explicitBase).origin;\n    }\n    if (scriptSrc) {\n      return new URL(scriptSrc).origin;\n    }\n  } catch {\n    // ignore parse errors\n  }\n\n  return null;\n}\n\nfunction resolveEvaluateUrl(options: FormBlockerInitOptions): string {\n  const optionBase = options.apiBaseUrl?.trim();\n  const baseUrl = optionBase && optionBase.length ? optionBase : DEFAULT_API_BASE;\n  const trimmedBase = baseUrl.replace(/\\/+$/, '');\n  const evaluatePath = (options.evaluatePath || '/api/v1/evaluate').trim() || '/api/v1/evaluate';\n  if (/^https?:\\/\\//i.test(evaluatePath)) {\n    return evaluatePath;\n  }\n  return `${trimmedBase}${evaluatePath.startsWith('/') ? evaluatePath : `/${evaluatePath}`}`;\n}\n\nfunction createOverlay(): HTMLDivElement {\n  const overlay = document.createElement('div');\n  overlay.className = 'fb-loading';\n  overlay.style.cssText = [\n    'position:absolute',\n    'top:0',\n    'left:0',\n    'right:0',\n    'bottom:0',\n    'background:rgba(255,255,255,0.8)',\n    'display:flex',\n    'align-items:center',\n    'justify-content:center',\n    'z-index:1000',\n  ].join(';');\n\n  const spinner = document.createElement('div');\n  spinner.style.cssText = [\n    'border:4px solid #f3f4f6',\n    'border-top:4px solid #3b82f6',\n    'border-radius:50%',\n    'width:40px',\n    'height:40px',\n    'animation:fb-spin 1s linear infinite',\n  ].join(';');\n\n  overlay.appendChild(spinner);\n\n  if (!document.getElementById('fb-styles')) {\n    const style = document.createElement('style');\n    style.id = 'fb-styles';\n    style.textContent =\n      '@keyframes fb-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }';\n    document.head.appendChild(style);\n  }\n\n  return overlay;\n}\n\ntype ModalTone = 'info' | 'warning' | 'error';\n\ninterface ModalOptions {\n  title: string;\n  message: string;\n  type: ModalTone;\n  subtitle?: string;\n  note?: string;\n  reasons?: string[];\n  submissionId?: string;\n  primaryActionLabel?: string;\n  primaryAction?: () => void;\n}\n\nlet modalStylesInjected = false;\n\nfunction ensureModalStyles(): void {\n  if (modalStylesInjected || typeof document === 'undefined') {\n    return;\n  }\n\n  const style = document.createElement('style');\n  style.id = 'fb-modal-styles';\n  style.textContent = `\n.fb-modal-overlay {\n  position: fixed;\n  inset: 0;\n  background: rgba(15, 23, 42, 0.75);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 24px;\n  z-index: 10000;\n  backdrop-filter: blur(2px);\n  transition: opacity 0.2s ease, transform 0.2s ease;\n}\n.fb-modal-overlay.fb-modal-hide {\n  opacity: 0;\n  transform: translateY(8px);\n}\n.fb-modal-window {\n  width: min(480px, calc(100% - 32px));\n  background: #ffffff;\n  color: #0f172a;\n  border-radius: 16px;\n  padding: 28px 28px 24px;\n  position: relative;\n  box-shadow: 0 35px 65px rgba(15, 23, 42, 0.35);\n  font-family: 'Inter', 'Noto Sans JP', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;\n}\n.fb-modal-hero {\n  width: 60px;\n  height: 60px;\n  border-radius: 18px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 1.8rem;\n  font-weight: 700;\n  margin-bottom: 18px;\n}\n.fb-modal-hero.fb-error {\n  background: rgba(239, 68, 68, 0.15);\n  color: #b91c1c;\n}\n.fb-modal-hero.fb-warning {\n  background: rgba(245, 158, 11, 0.15);\n  color: #92400e;\n}\n.fb-modal-hero.fb-info {\n  background: rgba(14, 165, 233, 0.15);\n  color: #0369a1;\n}\n.fb-modal-window.fb-error {\n  border-top: 4px solid #ef4444;\n}\n.fb-modal-window.fb-warning {\n  border-top: 4px solid #f59e0b;\n}\n.fb-modal-window.fb-info {\n  border-top: 4px solid #0ea5e9;\n}\n.fb-modal-close {\n  position: absolute;\n  top: 12px;\n  right: 12px;\n  border: none;\n  background: transparent;\n  font-size: 1.4rem;\n  color: #94a3b8;\n  cursor: pointer;\n}\n.fb-modal-title {\n  margin: 0 0 12px;\n  font-size: 1.4rem;\n  font-weight: 700;\n}\n.fb-modal-subtitle {\n  margin: 0 0 12px;\n  font-size: 0.95rem;\n  color: #475569;\n  line-height: 1.5;\n}\n.fb-modal-message {\n  margin: 0;\n  line-height: 1.6;\n  color: #1f2937;\n}\n.fb-modal-note {\n  margin-top: 18px;\n  font-size: 0.9rem;\n  color: #475569;\n  background: rgba(148, 163, 184, 0.15);\n  border-radius: 12px;\n  padding: 12px 14px;\n}\n.fb-reason-list {\n  margin: 16px 0 0;\n  padding-left: 20px;\n  color: #475569;\n}\n.fb-reason-list li {\n  margin-bottom: 4px;\n}\n.fb-submission-id {\n  margin-top: 18px;\n  font-size: 0.9rem;\n  color: #64748b;\n  word-break: break-all;\n}\n.fb-modal-actions {\n  margin-top: 24px;\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n}\n.fb-modal-btn {\n  border: none;\n  border-radius: 999px;\n  padding: 10px 18px;\n  font-size: 0.95rem;\n  font-weight: 600;\n  cursor: pointer;\n}\n.fb-modal-btn.fb-secondary {\n  background: #e2e8f0;\n  color: #0f172a;\n}\n.fb-modal-btn.fb-primary {\n  background: #111827;\n  color: #ffffff;\n}\n@media (prefers-color-scheme: dark) {\n  .fb-modal-window {\n    background: #0f172a;\n    color: #e2e8f0;\n    box-shadow: 0 35px 65px rgba(0, 0, 0, 0.65);\n  }\n  .fb-modal-message {\n    color: #e2e8f0;\n  }\n  .fb-reason-list {\n    color: #cbd5f5;\n  }\n  .fb-submission-id {\n    color: #94a3b8;\n  }\n  .fb-modal-btn.fb-secondary {\n    background: #1e293b;\n    color: #e2e8f0;\n  }\n  .fb-modal-btn.fb-primary {\n    background: #22d3ee;\n    color: #0f172a;\n  }\n  .fb-modal-subtitle,\n  .fb-modal-note {\n    color: #cbd5f5;\n    background: rgba(51, 65, 85, 0.6);\n  }\n}\n`;\n\n  document.head.appendChild(style);\n  modalStylesInjected = true;\n}\n\nfunction getHeroSymbol(type: ModalTone): string {\n  switch (type) {\n    case 'error':\n      return '!';\n    case 'warning':\n      return '?';\n    default:\n      return 'ℹ︎';\n  }\n}\n\nfunction showDecisionModal(options: ModalOptions): void {\n  if (typeof document === 'undefined') {\n    return;\n  }\n\n  ensureModalStyles();\n\n  const overlay = document.createElement('div');\n  overlay.className = 'fb-modal-overlay';\n\n  const modal = document.createElement('div');\n  modal.className = `fb-modal-window fb-${options.type}`;\n  modal.setAttribute('role', 'dialog');\n  modal.setAttribute('aria-modal', 'true');\n  modal.setAttribute('aria-label', options.title);\n\n  const hero = document.createElement('div');\n  hero.className = `fb-modal-hero fb-${options.type}`;\n  hero.setAttribute('aria-hidden', 'true');\n  hero.textContent = getHeroSymbol(options.type);\n\n  const closeModal = () => {\n    overlay.classList.add('fb-modal-hide');\n    window.setTimeout(() => {\n      if (overlay.parentElement) {\n        overlay.parentElement.removeChild(overlay);\n      }\n    }, 180);\n  };\n\n  const closeButton = document.createElement('button');\n  closeButton.className = 'fb-modal-close';\n  closeButton.type = 'button';\n  closeButton.setAttribute('aria-label', '閉じる');\n  closeButton.innerHTML = '&times;';\n  closeButton.addEventListener('click', closeModal);\n\n  const title = document.createElement('h2');\n  title.className = 'fb-modal-title';\n  title.textContent = options.title;\n\n  const subtitle = options.subtitle\n    ? (() => {\n        const element = document.createElement('p');\n        element.className = 'fb-modal-subtitle';\n        element.textContent = options.subtitle;\n        return element;\n      })()\n    : null;\n\n  const message = document.createElement('p');\n  message.className = 'fb-modal-message';\n  message.textContent = options.message;\n\n  modal.appendChild(closeButton);\n  modal.appendChild(hero);\n  modal.appendChild(title);\n  if (subtitle) {\n    modal.appendChild(subtitle);\n  }\n  modal.appendChild(message);\n\n  if (options.reasons && options.reasons.length > 0) {\n    const list = document.createElement('ul');\n    list.className = 'fb-reason-list';\n    options.reasons.forEach((reason) => {\n      const item = document.createElement('li');\n      item.textContent = reason;\n      list.appendChild(item);\n    });\n    modal.appendChild(list);\n  }\n\n  if (options.note) {\n    const note = document.createElement('p');\n    note.className = 'fb-modal-note';\n    note.textContent = options.note;\n    modal.appendChild(note);\n  }\n\n  if (options.submissionId) {\n    const submission = document.createElement('p');\n    submission.className = 'fb-submission-id';\n    submission.textContent = `受付ID: ${options.submissionId}`;\n    modal.appendChild(submission);\n  }\n\n  const actions = document.createElement('div');\n  actions.className = 'fb-modal-actions';\n\n  if (options.primaryAction && options.primaryActionLabel) {\n    const primaryButton = document.createElement('button');\n    primaryButton.className = 'fb-modal-btn fb-primary';\n    primaryButton.type = 'button';\n    primaryButton.textContent = options.primaryActionLabel;\n    primaryButton.addEventListener('click', () => {\n      options.primaryAction?.();\n      closeModal();\n    });\n    actions.appendChild(primaryButton);\n  }\n\n  const dismissButton = document.createElement('button');\n  dismissButton.className = 'fb-modal-btn fb-secondary';\n  dismissButton.type = 'button';\n  dismissButton.textContent = '閉じる';\n  dismissButton.addEventListener('click', closeModal);\n  actions.appendChild(dismissButton);\n\n  modal.appendChild(actions);\n  overlay.appendChild(modal);\n\n  overlay.addEventListener('click', (event) => {\n    if (event.target === overlay) {\n      closeModal();\n    }\n  });\n\n  document.body.appendChild(overlay);\n}\n\nfunction showBlockModal(result: EvaluateSuccessResponse): void {\n  const message =\n    result.message || '営業目的または不正な送信と判定されたため、送信をブロックしました。';\n\n  showDecisionModal({\n    title: '送信がブロックされました',\n    subtitle: '申し訳ありませんが、この送信内容は営業目的またはスパムの可能性が高いため送信できませんでした。',\n    message,\n    type: 'error',\n    reasons: result.reasons,\n    submissionId: result.submission_id,\n    note:\n      '心当たりがない場合は、入力内容を見直すか別の連絡手段でお問い合わせください。再送時は URL や営業キーワードが含まれていないかをご確認ください。',\n  });\n}\n\nfunction showBanner(message: string, type: 'info' | 'error'): void {\n  const div = document.createElement('div');\n  div.className = `fb-message fb-${type}`;\n  div.textContent = message;\n  div.style.cssText = [\n    'position:fixed',\n    'top:20px',\n    'left:50%',\n    'transform:translateX(-50%)',\n    'padding:16px 24px',\n    'border-radius:8px',\n    `background:${type === 'error' ? '#ef4444' : '#3b82f6'}`,\n    'color:white',\n    'box-shadow:0 4px 6px rgba(0,0,0,0.1)',\n    'z-index:10000',\n    'font-family:sans-serif',\n  ].join(';');\n\n  document.body.appendChild(div);\n\n  setTimeout(() => {\n    div.style.transition = 'opacity 0.3s';\n    div.style.opacity = '0';\n    setTimeout(() => {\n      if (div.parentElement) {\n        div.parentElement.removeChild(div);\n      }\n    }, 300);\n  }, 3000);\n}\n\nclass FormBlockerCore {\n  private config: InternalConfig | null = null;\n  private contexts = new Map<HTMLFormElement, FormContext>();\n  private mutationObserver: MutationObserver | null = null;\n  private pendingAttachScan = false;\n  private discoveryInterval: number | null = null;\n  private discoveryTimeoutTimer: number | null = null;\n  private lastFoundFormsCount = -1;\n\n  init(options: FormBlockerInitOptions): void {\n    if (typeof window === 'undefined' || typeof document === 'undefined') {\n      return;\n    }\n\n    if (!options || !options.apiKey) {\n      console.error('[FormBlocker] apiKey is required');\n      return;\n    }\n\n    this.destroy();\n\n    const normalizeKeywords = (keywords: string[]) => keywords.map((kw) => kw.toLowerCase());\n\n    this.config = {\n      apiKey: options.apiKey,\n      evaluateUrl: resolveEvaluateUrl(options),\n      selector: options.selector || 'form',\n      debug: Boolean(options.debug),\n      previewMode: Boolean(options.previewMode),\n      salesKeywords: options.debugRules?.salesKeywords?.length\n        ? normalizeKeywords(options.debugRules.salesKeywords)\n        : normalizeKeywords(DEFAULT_SALES_KEYWORDS),\n      bannedKeywords: options.debugRules?.bannedKeywords?.length\n        ? normalizeKeywords(options.debugRules.bannedKeywords)\n        : normalizeKeywords(DEFAULT_BANNED_KEYWORDS),\n      blockedDomains: options.debugRules?.blockedDomains?.length\n        ? options.debugRules.blockedDomains.map(normalizeDomain)\n        : [],\n      observeMutations: options.observeMutations !== false,\n      discoveryIntervalMs:\n        typeof options.discoveryIntervalMs === 'number' && options.discoveryIntervalMs > 0\n          ? options.discoveryIntervalMs\n          : 1500,\n      discoveryTimeoutMs:\n        typeof options.discoveryTimeoutMs === 'number' && options.discoveryTimeoutMs > 0\n          ? options.discoveryTimeoutMs\n          : 20000,\n      onAllow: options.onAllow,\n      onBlock: options.onBlock,\n      onChallenge: options.onChallenge,\n      onHold: options.onHold,\n      onError: options.onError,\n      onDetectionUpdate: options.onDetectionUpdate,\n    };\n\n    this.log('Initialized with config', this.config);\n    console.info(\n      `[FormBlocker ${FORM_BLOCKER_VERSION}] Initialized (selector: \"${this.config.selector}\", evaluateUrl: \"${this.config.evaluateUrl}\", previewMode: ${this.config.previewMode})`\n    );\n    this.attachToForms();\n    this.startMutationObserver();\n    this.startDiscoveryLoop();\n  }\n\n  refresh(): void {\n    if (!this.config) {\n      this.log('Refresh skipped: config not initialized');\n      return;\n    }\n    this.attachToForms();\n  }\n\n  destroy(): void {\n    this.stopMutationObserver();\n    this.stopDiscoveryLoop();\n    this.contexts.forEach((context, form) => {\n      form.removeAttribute('data-fb-attached');\n      form.removeEventListener('submit', context.submitHandler, true);\n      context.pasteHandlers.forEach(({ element, handler }) => {\n        element.removeEventListener('paste', handler);\n      });\n      context.inputHandlers.forEach(({ element, handler }) => {\n        element.removeEventListener('input', handler);\n      });\n    });\n    this.contexts.clear();\n    this.lastFoundFormsCount = -1;\n  }\n\n  private attachToForms(): void {\n    if (!this.config) {\n      return;\n    }\n\n    console.info(\n      `[FormBlocker ${FORM_BLOCKER_VERSION}] Scanning forms (selector: \"${this.config.selector}\")`\n    );\n\n    // Clean up contexts for forms that were removed from the DOM\n    this.contexts.forEach((context, form) => {\n      if (!document.body.contains(form)) {\n        form.removeEventListener('submit', context.submitHandler, true);\n        context.pasteHandlers.forEach(({ element, handler }) => {\n          element.removeEventListener('paste', handler);\n        });\n        context.inputHandlers.forEach(({ element, handler }) => {\n          element.removeEventListener('input', handler);\n        });\n        this.contexts.delete(form);\n      }\n    });\n\n    const forms = document.querySelectorAll<HTMLFormElement>(this.config.selector);\n    this.log('Searching forms with selector', {\n      selector: this.config.selector,\n      found: forms.length,\n    });\n    if (forms.length === 0) {\n      if (this.lastFoundFormsCount !== 0) {\n        console.warn(\n          `[FormBlocker ${FORM_BLOCKER_VERSION}] No forms matched selector ${this.config.selector}`\n        );\n      }\n    } else if (forms.length !== this.lastFoundFormsCount) {\n      console.info(\n        `[FormBlocker ${FORM_BLOCKER_VERSION}] Found ${forms.length} form(s) for selector \"${this.config.selector}\"`\n      );\n    }\n    this.lastFoundFormsCount = forms.length;\n    forms.forEach((form) => {\n      if (this.contexts.has(form)) {\n        return;\n      }\n      this.attachToForm(form);\n    });\n  }\n\n  private startMutationObserver(): void {\n    if (!this.config?.observeMutations) {\n      this.log('Mutation observer disabled via config');\n      return;\n    }\n    if (typeof MutationObserver === 'undefined' || typeof document === 'undefined') {\n      this.log('MutationObserver not available in this environment');\n      return;\n    }\n    if (this.mutationObserver) {\n      this.mutationObserver.disconnect();\n    }\n    this.mutationObserver = new MutationObserver((mutations) => {\n      let shouldScan = false;\n      for (const mutation of mutations) {\n        if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {\n          shouldScan = true;\n          break;\n        }\n      }\n      if (shouldScan) {\n        console.info(`[FormBlocker ${FORM_BLOCKER_VERSION}] DOM mutation detected, rescanning forms`);\n        this.scheduleAttachScan();\n      }\n    });\n    this.mutationObserver.observe(document.body, { childList: true, subtree: true });\n    console.info(`[FormBlocker ${FORM_BLOCKER_VERSION}] Watching DOM for newly added forms`);\n  }\n\n  private stopMutationObserver(): void {\n    if (this.mutationObserver) {\n      this.mutationObserver.disconnect();\n      this.mutationObserver = null;\n    }\n    this.pendingAttachScan = false;\n  }\n\n  private startDiscoveryLoop(): void {\n    if (!this.config) return;\n    const interval = this.config.discoveryIntervalMs;\n    if (!(interval > 0)) {\n      this.log('Discovery loop disabled (interval <= 0)');\n      return;\n    }\n    this.stopDiscoveryLoop();\n    const runScan = () => this.attachToForms();\n    this.discoveryInterval = window.setInterval(runScan, interval);\n    const timeout = this.config.discoveryTimeoutMs;\n    if (timeout && timeout > 0) {\n      this.discoveryTimeoutTimer = window.setTimeout(() => {\n        this.stopDiscoveryLoop();\n        this.log('Discovery loop stopped after timeout');\n      }, timeout);\n    }\n    console.info(\n      `[FormBlocker ${FORM_BLOCKER_VERSION}] Discovery loop started (interval: ${interval}ms${\n        timeout && timeout > 0 ? `, timeout: ${timeout}ms` : ''\n      })`\n    );\n  }\n\n  private stopDiscoveryLoop(): void {\n    if (this.discoveryInterval) {\n      window.clearInterval(this.discoveryInterval);\n      this.discoveryInterval = null;\n    }\n    if (this.discoveryTimeoutTimer) {\n      window.clearTimeout(this.discoveryTimeoutTimer);\n      this.discoveryTimeoutTimer = null;\n    }\n  }\n\n  private scheduleAttachScan(): void {\n    if (this.pendingAttachScan) return;\n    this.pendingAttachScan = true;\n    const schedule = typeof window !== 'undefined' && window.requestAnimationFrame\n      ? window.requestAnimationFrame\n      : (cb: FrameRequestCallback) => setTimeout(cb, 16);\n    schedule(() => {\n      this.pendingAttachScan = false;\n      this.attachToForms();\n    });\n  }\n\n  private attachToForm(form: HTMLFormElement): void {\n    if (!this.config) {\n      return;\n    }\n\n    const behavioral: BehavioralSnapshot = {\n      pasteDetected: false,\n      timeToSubmit: null,\n      pageLoadTime: Date.now(),\n    };\n\n    const submitHandler = (event: Event) => {\n      this.handleSubmit(event as SubmitEvent, form, behavioral).catch((error) => {\n        this.log('Submission handling failed', error);\n      });\n    };\n\n    const pasteHandlers: Array<{ element: Element; handler: EventListener }> = [];\n    const inputHandlers: Array<{ element: Element; handler: EventListener }> = [];\n    const inputElements = form.querySelectorAll('input, textarea');\n    inputElements.forEach((element) => {\n      const handler = () => {\n        behavioral.pasteDetected = true;\n        this.log('Paste detected for form', form);\n        this.emitDetectionUpdate(form, behavioral);\n      };\n      element.addEventListener('paste', handler);\n      pasteHandlers.push({ element, handler });\n    });\n\n    inputElements.forEach((element) => {\n      const handler = () => {\n        this.emitDetectionUpdate(form, behavioral);\n      };\n      element.addEventListener('input', handler);\n      inputHandlers.push({ element, handler });\n    });\n\n    form.addEventListener('submit', submitHandler, true);\n    form.setAttribute('data-fb-attached', 'true');\n\n    this.emitDetectionUpdate(form, behavioral);\n\n    this.contexts.set(form, {\n      originalSubmit: form.onsubmit,\n      submitHandler,\n      pasteHandlers,\n      inputHandlers,\n      behavioral,\n    });\n\n    this.log('Attached to form', form);\n    console.info(\n      `[FormBlocker ${FORM_BLOCKER_VERSION}] Attached to form (selector: \"${this.config.selector}\")`,\n      form\n    );\n  }\n\n  private async handleSubmit(\n    event: SubmitEvent,\n    form: HTMLFormElement,\n    behavioral: BehavioralSnapshot\n  ): Promise<void> {\n    if (!this.config) {\n      return;\n    }\n\n    event.preventDefault();\n    event.stopPropagation();\n    this.log('Intercepted submit', { selector: this.config.selector });\n\n    behavioral.timeToSubmit = (Date.now() - behavioral.pageLoadTime) / 1000;\n\n    this.showLoading(form);\n\n    this.emitDetectionUpdate(form, behavioral);\n\n    try {\n      const payload = this.buildRequestBody(form, behavioral);\n      this.log('Submitting payload', payload);\n\n      const response = await fetch(this.config.evaluateUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(payload),\n      });\n\n      if (!response.ok) {\n        throw new Error(`API request failed with status ${response.status}`);\n      }\n\n      const result = (await response.json()) as EvaluateResponsePayload;\n      this.log('Received response', result);\n\n      if (!result.success) {\n        const message = result.error?.message || 'エラーが発生しました。後ほど再度お試しください。';\n        showBanner(message, 'error');\n        this.config.onError?.(result);\n        this.hideLoading(form);\n        return;\n      }\n\n      this.handleDecision(result, form);\n    } catch (error) {\n      console.error('[FormBlocker] API error', error);\n      this.config.onError?.(error);\n      this.hideLoading(form);\n      this.allowSubmission(form);\n    }\n  }\n\n  private buildRequestBody(form: HTMLFormElement, behavioral: BehavioralSnapshot) {\n    const metadata = {\n      url: typeof window !== 'undefined' ? window.location.href : '',\n      user_agent: typeof navigator !== 'undefined' ? navigator.userAgent : '',\n      timestamp: Date.now(),\n    };\n\n    const behavioralData: Record<string, unknown> = {\n      paste_detected: behavioral.pasteDetected,\n    };\n\n    if (typeof behavioral.timeToSubmit === 'number' && !Number.isNaN(behavioral.timeToSubmit)) {\n      behavioralData.time_to_submit = behavioral.timeToSubmit;\n    }\n\n    return {\n      api_key: this.config?.apiKey,\n      form_data: this.extractFormData(form),\n      metadata,\n      behavioral_data: behavioralData,\n    };\n  }\n\n  private extractFormData(form: HTMLFormElement): Record<string, unknown> {\n    const data: Record<string, unknown> = {};\n    const elements = Array.from(form.elements) as Array<HTMLInputElement | HTMLTextAreaElement>;\n\n    elements.forEach((element) => {\n      if (!element.name) {\n        return;\n      }\n\n      const type = (element as HTMLInputElement).type;\n      if (type === 'checkbox') {\n        const input = element as HTMLInputElement;\n        if (!data[element.name]) {\n          data[element.name] = [];\n        }\n        if (input.checked) {\n          (data[element.name] as unknown[]).push(input.value);\n        }\n        return;\n      }\n\n      if (type === 'radio') {\n        const input = element as HTMLInputElement;\n        if (input.checked) {\n          data[element.name] = input.value;\n        } else if (!(element.name in data)) {\n          data[element.name] = null;\n        }\n        return;\n      }\n\n      data[element.name] = element.value;\n    });\n\n    return data;\n  }\n\n  private handleDecision(result: EvaluateSuccessResponse, form: HTMLFormElement): void {\n    this.log('Handling decision', {\n      decision: result.decision,\n      scores: result.scores,\n      reasons: result.reasons,\n      challenge: result.challenge,\n      submissionId: result.submission_id,\n    });\n    switch (result.decision) {\n      case 'allowed':\n        this.allowSubmission(form);\n        this.hideLoading(form);\n        this.config?.onAllow?.(result);\n        break;\n      case 'challenged':\n        this.hideLoading(form);\n        this.handleChallenge(result, form);\n        break;\n      case 'held':\n        this.hideLoading(form);\n        showBanner(result.message, 'info');\n        this.config?.onHold?.(result);\n        break;\n      case 'blocked':\n        this.hideLoading(form);\n        showBlockModal(result);\n        this.config?.onBlock?.(result);\n        break;\n      default:\n        this.hideLoading(form);\n        this.allowSubmission(form);\n    }\n  }\n\n  private handleChallenge(result: EvaluateSuccessResponse, form: HTMLFormElement): void {\n    this.log('Challenge presented', {\n      question: result.challenge?.question,\n      submissionId: result.submission_id,\n    });\n    const allow = () => {\n      this.allowSubmission(form);\n      this.config?.onAllow?.(result);\n    };\n\n    if (this.config?.onChallenge) {\n      this.config.onChallenge(result, allow);\n      return;\n    }\n\n    const question =\n      result.challenge?.question || 'この送信は営業目的ではありませんか？送信を続けますか？';\n    const confirmed = window.confirm(`${question}\\n\\n「OK」を押すと送信されます。`);\n    if (confirmed) {\n      allow();\n    }\n  }\n\n  private allowSubmission(form: HTMLFormElement): void {\n    if (this.config?.previewMode) {\n      this.log('Preview mode enabled: submission prevented');\n      return;\n    }\n    this.log('Allowing native submission');\n    const context = this.contexts.get(form);\n    if (context?.originalSubmit) {\n      const event = new Event('submit', { bubbles: true, cancelable: true });\n      context.originalSubmit.call(form, event as SubmitEvent);\n    } else {\n      form.submit();\n    }\n  }\n\n  private showLoading(form: HTMLFormElement): void {\n    if (!form.querySelector('.fb-loading')) {\n      const overlay = createOverlay();\n      const style = window.getComputedStyle(form);\n      if (style.position === 'static' || !style.position) {\n        form.style.position = 'relative';\n      }\n      form.appendChild(overlay);\n    }\n  }\n\n  private hideLoading(form: HTMLFormElement): void {\n    const overlay = form.querySelector('.fb-loading');\n    if (overlay && overlay.parentElement) {\n      overlay.parentElement.removeChild(overlay);\n    }\n  }\n\n  private isDebugEnabled(): boolean {\n    if (this.config?.debug) return true;\n    if (typeof window === 'undefined') return false;\n\n    const flagFromWindow = (window as { FormBlockerDebug?: boolean }).FormBlockerDebug === true;\n    const flagFromStorage = localStorage.getItem('formblocker:debug') === 'true';\n    const params = new URLSearchParams(window.location.search);\n    const flagFromQuery = params.get('fb_debug') === '1' || params.get('formblocker_debug') === '1';\n\n    return flagFromWindow || flagFromStorage || flagFromQuery;\n  }\n\n  private log(message: string, payload?: unknown): void {\n    if (!this.isDebugEnabled()) return;\n    if (payload !== undefined) {\n      console.log(`[FormBlocker ${FORM_BLOCKER_VERSION}] ${message}`, payload);\n    } else {\n      console.log(`[FormBlocker ${FORM_BLOCKER_VERSION}] ${message}`);\n    }\n  }\n\n  private emitDetectionUpdate(form: HTMLFormElement, behavioral: BehavioralSnapshot): void {\n    const context = this.contexts.get(form);\n    const formData = this.extractFormData(form);\n    const snapshot = this.analyzeDetection(formData, behavioral);\n\n    context && (context.lastDetection = snapshot);\n\n    this.log('Detection snapshot', snapshot);\n\n    this.config?.onDetectionUpdate?.(snapshot);\n  }\n\n  private analyzeDetection(formData: Record<string, unknown>, behavioral: BehavioralSnapshot): DetectionSnapshot {\n    const textFragments = Object.values(formData).map((value) => {\n      if (typeof value === 'string') return value;\n      if (Array.isArray(value)) return value.join(' ');\n      return '';\n    });\n\n    const values = textFragments.join(' ').toLowerCase();\n\n    const urlRegex = /(https?:\\/\\/[^\\s]+)/gi;\n    const detectedUrls = values.match(urlRegex) || [];\n    const schedulingUrls = detectedUrls.filter((url) => {\n      const domain = extractHostname(url);\n      if (!domain) return false;\n      return DEFAULT_SCHEDULING_DOMAINS.some((target) => matchesDomain(domain, target));\n    });\n\n    const salesKeywords = this.config?.salesKeywords || DEFAULT_SALES_KEYWORDS;\n    const bannedKeywords = this.config?.bannedKeywords || DEFAULT_BANNED_KEYWORDS;\n\n    const detectedSales = salesKeywords.filter((kw) => kw && values.includes(kw.toLowerCase()));\n    const detectedBanned = bannedKeywords.filter((kw) => kw && values.includes(kw.toLowerCase()));\n\n    const emailDomains = collectEmailDomains(formData);\n    const blockedDomainMatches: string[] = [];\n    const configuredBlockedDomains = this.config?.blockedDomains || [];\n\n    if (configuredBlockedDomains.length > 0) {\n      const urlDomains = Array.from(\n        new Set(\n          detectedUrls\n            .map((url) => extractHostname(url))\n            .filter((domain): domain is string => Boolean(domain))\n        )\n      );\n      const candidates = Array.from(new Set([...urlDomains, ...emailDomains])).map(normalizeDomain);\n      candidates.forEach((domain) => {\n        if (configuredBlockedDomains.some((blocked) => matchesDomain(domain, blocked))) {\n          blockedDomainMatches.push(domain);\n        }\n      });\n    }\n\n    return {\n      urlDetected: detectedUrls.length > 0,\n      detectedUrls,\n      schedulingUrls,\n      salesKeywords: detectedSales,\n      bannedKeywords: detectedBanned,\n      blockedDomains: blockedDomainMatches,\n      pasteDetected: behavioral.pasteDetected,\n      contentLength: values.length,\n      updatedAt: Date.now(),\n    };\n  }\n}\n\nconst core = new FormBlockerCore();\n\nconst FormBlocker = {\n  init(options: FormBlockerInitOptions): void {\n    if (typeof window !== 'undefined') {\n      const persistentDebug = localStorage.getItem('formblocker:debug');\n      const globalFlag = (window as { FormBlockerDebug?: boolean }).FormBlockerDebug === true;\n      const params = new URLSearchParams(window.location.search);\n      const queryDebug = params.get('fb_debug') === '1' || params.get('formblocker_debug') === '1';\n\n      if (persistentDebug === 'true' || globalFlag || queryDebug) {\n        options = { ...options, debug: true };\n      }\n    }\n    core.init(options);\n\n    // Always log one line soオペレーション側が初期化に気づける\n    console.info(\n      `[FormBlocker ${FORM_BLOCKER_VERSION}] init called`,\n      {\n        selector: options.selector || 'form',\n        debug: options.debug,\n        previewMode: options.previewMode,\n      }\n    );\n  },\n  refresh(): void {\n    core.refresh();\n  },\n  destroy(): void {\n    core.destroy();\n  },\n};\n\ndeclare global {\n  interface Window {\n    FormBlocker?: typeof FormBlocker;\n    FormBlockerAutoInit?: FormBlockerInitOptions;\n  }\n}\n\nif (typeof window !== 'undefined') {\n  console.info(`[FormBlocker ${FORM_BLOCKER_VERSION}] Script loaded`);\n  window.FormBlocker = FormBlocker;\n  (window as typeof window & { FormBlockerVersion?: string }).FormBlockerVersion = FORM_BLOCKER_VERSION;\n\n  const autoInit = window.FormBlockerAutoInit;\n  if (autoInit) {\n    FormBlocker.init(autoInit);\n  }\n\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => {\n      const pendingConfig = window.FormBlockerAutoInit;\n      if (pendingConfig) {\n        FormBlocker.init(pendingConfig);\n      }\n    });\n  }\n}\n\nexport default FormBlocker;\n"],"names":["FORM_BLOCKER_VERSION","DEFAULT_API_BASE","DEFAULT_SALES_KEYWORDS","DEFAULT_BANNED_KEYWORDS","DEFAULT_SCHEDULING_DOMAINS","normalizeDomain","domain","matchesDomain","target","extractHostname","url","match","_a","collectEmailDomains","formData","domains","regex","value","matches","resolveEvaluateUrl","options","optionBase","trimmedBase","evaluatePath","createOverlay","overlay","spinner","style","modalStylesInjected","ensureModalStyles","getHeroSymbol","type","showDecisionModal","modal","hero","closeModal","closeButton","title","subtitle","element","message","list","reason","item","note","submission","actions","primaryButton","dismissButton","event","showBlockModal","result","showBanner","div","FormBlockerCore","normalizeKeywords","keywords","kw","_b","_d","_c","_f","_e","context","form","handler","forms","mutations","shouldScan","mutation","interval","runScan","timeout","cb","behavioral","submitHandler","error","pasteHandlers","inputHandlers","inputElements","payload","response","metadata","behavioralData","data","input","allow","question","flagFromWindow","flagFromStorage","params","flagFromQuery","snapshot","values","urlRegex","detectedUrls","schedulingUrls","salesKeywords","bannedKeywords","detectedSales","detectedBanned","emailDomains","blockedDomainMatches","configuredBlockedDomains","urlDomains","blocked","core","FormBlocker","persistentDebug","globalFlag","queryDebug","autoInit","pendingConfig"],"mappings":"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"}